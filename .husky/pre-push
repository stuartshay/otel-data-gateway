#!/bin/sh

echo "üîç Running cspell spell check..."
npm run lint:spell
CSPELL_EXIT=$?

echo "üîê Running detect-secrets scan..."
if command -v detect-secrets >/dev/null 2>&1; then
  # Use a temp copy to avoid mutating .secrets.baseline (generated_at timestamp)
  TMPBASELINE=$(mktemp)
  cp .secrets.baseline "$TMPBASELINE"
  detect-secrets scan --baseline "$TMPBASELINE"
  SECRETS_EXIT=$?
  rm -f "$TMPBASELINE"
else
  echo "‚ö†Ô∏è  detect-secrets not installed, skipping (pip install detect-secrets)"
  SECRETS_EXIT=0
fi

if [ $CSPELL_EXIT -ne 0 ]; then
  echo ""
  echo "‚ùå cspell found spelling issues. Fix them or add words to cspell.json"
  exit 1
fi

if [ $SECRETS_EXIT -ne 0 ]; then
  echo ""
  echo "‚ùå detect-secrets found potential secrets. Review .secrets.baseline"
  exit 1
fi

echo "‚úÖ Pre-push checks passed"
